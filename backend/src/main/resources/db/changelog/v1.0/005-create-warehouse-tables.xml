<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.25.xsd">

    <changeSet id="040-create-warehouses-table" author="elektromeistras">
        <createTable tableName="warehouses">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="name" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="address" type="TEXT"/>
            <column name="city" type="VARCHAR(100)"/>
            <column name="is_active" type="BOOLEAN" defaultValueBoolean="true"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(100)"/>
            <column name="updated_by" type="VARCHAR(100)"/>
            <column name="version" type="BIGINT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="041-create-warehouse-locations-table" author="elektromeistras">
        <createTable tableName="warehouse_locations">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="warehouse_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_location_warehouse" references="warehouses(id)"/>
            </column>
            <column name="code" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="zone" type="VARCHAR(50)"/>
            <column name="aisle" type="VARCHAR(10)"/>
            <column name="rack" type="VARCHAR(10)"/>
            <column name="level" type="INTEGER"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(100)"/>
            <column name="updated_by" type="VARCHAR(100)"/>
            <column name="version" type="BIGINT" defaultValueNumeric="0"/>
        </createTable>
        <addUniqueConstraint tableName="warehouse_locations" columnNames="warehouse_id,code"/>
    </changeSet>

    <changeSet id="042-create-product-stock-table" author="elektromeistras">
        <createTable tableName="product_stock">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="product_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_stock_product" references="products(id)"/>
            </column>
            <column name="warehouse_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_stock_warehouse" references="warehouses(id)"/>
            </column>
            <column name="location_id" type="UUID">
                <constraints foreignKeyName="fk_stock_location" references="warehouse_locations(id)"/>
            </column>
            <column name="quantity" type="DECIMAL(12,3)" defaultValueNumeric="0.000">
                <constraints nullable="false"/>
            </column>
            <column name="reserved_quantity" type="DECIMAL(12,3)" defaultValueNumeric="0.000"/>
            <column name="roll_id" type="VARCHAR(50)"/>
            <column name="roll_current_length" type="DECIMAL(10,2)"/>
            <column name="reorder_point" type="DECIMAL(12,3)"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(100)"/>
            <column name="updated_by" type="VARCHAR(100)"/>
            <column name="version" type="BIGINT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="043-create-picking-waves-table" author="elektromeistras">
        <createTable tableName="picking_waves">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="wave_number" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="warehouse_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_wave_warehouse" references="warehouses(id)"/>
            </column>
            <column name="status" type="VARCHAR(20)" defaultValue="CREATED"/>
            <column name="assigned_to" type="UUID">
                <constraints foreignKeyName="fk_wave_assigned_to" references="users(id)"/>
            </column>
            <column name="total_orders" type="INTEGER" defaultValueNumeric="0"/>
            <column name="route_json" type="JSONB"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(100)"/>
            <column name="updated_by" type="VARCHAR(100)"/>
            <column name="version" type="BIGINT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

    <changeSet id="044-create-picking-tasks-table" author="elektromeistras">
        <createTable tableName="picking_tasks">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="wave_id" type="UUID">
                <constraints foreignKeyName="fk_task_wave" references="picking_waves(id)"/>
            </column>
            <column name="order_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_task_order" references="orders(id)"/>
            </column>
            <column name="product_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_task_product" references="products(id)"/>
            </column>
            <column name="location_id" type="UUID">
                <constraints nullable="false" foreignKeyName="fk_task_location" references="warehouse_locations(id)"/>
            </column>
            <column name="quantity_to_pick" type="DECIMAL(12,3)">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_picked" type="DECIMAL(12,3)" defaultValueNumeric="0.000"/>
            <column name="sequence_number" type="INTEGER"/>
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(100)"/>
            <column name="updated_by" type="VARCHAR(100)"/>
            <column name="version" type="BIGINT" defaultValueNumeric="0"/>
        </createTable>
    </changeSet>

</databaseChangeLog>
